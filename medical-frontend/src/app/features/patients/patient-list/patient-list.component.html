<div class="patient-list-container">
  <!-- Header -->
  <div class="page-header">
    <div>
      <h1 class="page-title">Patient Directory</h1>
      <p class="page-subtitle">Manage, search, and view all registered patient records.</p>
    </div>
    <button class="btn-primary" (click)="newPatient()">
      <span class="material-symbols-outlined">add</span>
      New Patient
    </button>
  </div>

  <!-- Filters & Search Bar -->
  <div class="filter-card">
    <div class="filter-grid">
      <!-- Search Input -->
      <div class="search-input-wrapper">
        <span class="material-symbols-outlined search-icon">search</span>
        <input
          type="text"
          class="search-input"
          [(ngModel)]="searchTerm"
          (input)="onSearch()"
          placeholder="Search by Name, SSN, or Email..."
        />
      </div>

      <!-- Filters -->
      <div class="filters-wrapper">
        <select class="filter-select" [(ngModel)]="selectedCity" (change)="applyFilters()">
          <option value="all">All Cities</option>
          <option value="New York">New York</option>
          <option value="Chicago">Chicago</option>
          <option value="San Francisco">San Francisco</option>
        </select>

        <select class="filter-select" [(ngModel)]="selectedStatus" (change)="applyFilters()">
          <option value="all">Any Status</option>
          <option value="active">Active</option>
          <option value="archived">Archived</option>
        </select>

        <select class="filter-select" [(ngModel)]="selectedAllergy" (change)="applyFilters()">
          <option value="all">Allergies (All)</option>
          <option value="Peanuts">Peanuts</option>
          <option value="Penicillin">Penicillin</option>
          <option value="None">None</option>
        </select>

        <button class="btn-clear" (click)="clearFilters()">
          Clear Filters
        </button>
      </div>
    </div>
  </div>

  <!-- Loading State -->
  <div *ngIf="loading" class="loading-container">
    <div class="spinner"></div>
    <p>Loading patients...</p>
  </div>

  <!-- Error State -->
  <div *ngIf="error" class="error-container">
    <span class="material-symbols-outlined">error</span>
    <p>{{ error }}</p>
    <button class="btn-retry" (click)="loadPatients()">Retry</button>
  </div>

  <!-- Table Container -->
  <div *ngIf="!loading && !error" class="table-card">
    <div class="table-wrapper">
      <table class="patients-table">
        <thead>
        <tr>
          <th>Patient Name</th>
          <th>SSN</th>
          <th>Age / DOB</th>
          <th>Contact Info</th>
          <th>Location</th>
          <th>Medical Alerts</th>
          <th class="text-right">Actions</th>
        </tr>
        </thead>
        <tbody>
        <tr *ngFor="let patient of paginatedPatients" class="table-row">
          <!-- Patient Name -->
          <td>
            <div class="patient-cell">
              <div class="patient-avatar">
                {{ patient.nom.charAt(0) }}{{ patient.prenom.charAt(0) }}
              </div>
              <div class="patient-info">
                <a class="patient-name" (click)="viewPatient(patient.id!)">
                  {{ patient.nom }} {{ patient.prenom }}
                </a>
                <span class="patient-email">{{ patient.email }}</span>
              </div>
            </div>
          </td>

          <!-- SSN -->
          <td>
            <div class="ssn-cell">
              <span class="ssn-text">{{ formatSSN(patient.numeroSecu) }}</span>
              <span class="material-symbols-outlined visibility-icon">visibility</span>
            </div>
          </td>

          <!-- Age / DOB -->
          <td>
            <div class="age-cell">
              <span class="age-text">{{ calculateAge(patient.dateNaissance) }} yrs</span>
              <span class="dob-text">{{ patient.dateNaissance | date: 'MMM dd, yyyy' }}</span>
            </div>
          </td>

          <!-- Contact Info -->
          <td>
            <span class="contact-text">{{ patient.telephone }}</span>
          </td>

          <!-- Location -->
          <td>
            <span class="location-badge">{{ patient.ville }}</span>
          </td>

          <!-- Medical Alerts -->
          <td>
            <div class="alerts-cell">
                <span *ngIf="patient.allergies" class="alert-badge alert-danger">
                  <span class="material-symbols-outlined">warning</span>
                  {{ patient.allergies }}
                </span>
              <span *ngIf="patient.maladiesChroniques" class="alert-badge alert-warning">
                  <span class="material-symbols-outlined">medical_services</span>
                {{ patient.maladiesChroniques }}
                </span>
              <span *ngIf="!patient.allergies && !patient.maladiesChroniques" class="no-alerts">
                  No registered alerts
                </span>
            </div>
          </td>

          <!-- Actions -->
          <td class="text-right">
            <div class="actions-cell">
              <button class="btn-icon" (click)="viewPatient(patient.id!)" title="View Details">
                <span class="material-symbols-outlined">visibility</span>
              </button>
              <button class="btn-icon" (click)="editPatient(patient.id!)" title="Edit Patient">
                <span class="material-symbols-outlined">edit</span>
              </button>
              <button class="btn-icon btn-icon-danger" (click)="deletePatient(patient.id!)" title="Delete">
                <span class="material-symbols-outlined">delete</span>
              </button>
            </div>
          </td>
        </tr>
        </tbody>
      </table>
    </div>

    <!-- Pagination -->
    <div class="pagination-footer">
      <div class="pagination-info">
        Showing
        <span class="pagination-highlight">{{ (currentPage - 1) * itemsPerPage + 1 }}</span>
        to
        <span class="pagination-highlight">{{ Math.min(currentPage * itemsPerPage, totalItems) }}</span>
        of
        <span class="pagination-highlight">{{ totalItems }}</span>
        patients
      </div>

      <div class="pagination-controls">
        <select class="per-page-select" [(ngModel)]="itemsPerPage" (change)="changeItemsPerPage(itemsPerPage)">
          <option [value]="10">10 per page</option>
          <option [value]="20">20 per page</option>
          <option [value]="50">50 per page</option>
        </select>

        <div class="pagination-buttons">
          <button
            class="page-btn"
            [disabled]="currentPage === 1"
            (click)="changePage(currentPage - 1)">
            <span class="material-symbols-outlined">chevron_left</span>
          </button>

          <button
            *ngFor="let page of [].constructor(totalPages); let i = index"
            class="page-btn"
            [class.active]="currentPage === i + 1"
            (click)="changePage(i + 1)">
            {{ i + 1 }}
          </button>

          <button
            class="page-btn"
            [disabled]="currentPage === totalPages"
            (click)="changePage(currentPage + 1)">
            <span class="material-symbols-outlined">chevron_right</span>
          </button>
        </div>
      </div>
    </div>
  </div>
</div>
